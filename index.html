<!DOCTYPE html>
<html lang="en">
<head>
  <!-- html2pdf.js bundle (includes html2canvas + jsPDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Everest Digital Stationery - GST Invoice</title>
  <style>
    /* ... [Your CSS remains unchanged] ... */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background-color: #1b3a57;
      color: white;
      padding: 15px 20px;
      text-align: center;
      font-size: 28px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    header img {
      height: 40px;
      user-select: none;
    }
    nav {
      background: #2d5a88;
      padding: 12px;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    nav button {
      background: white;
      border: none;
      padding: 10px 16px;
      border-radius: 5px;
      font-weight: 600;
      color: #2d5a88;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background-color 0.3s;
    }
    nav button:hover {
      background-color: #e3ecf7;
    }
    .container {
      padding: 25px;
      max-width: 1200px;
      margin: auto;
    }
    .box {
      background: white;
      border: 1px solid #dce1e7;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    label {
      font-weight: 600;
      min-width: 140px;
      display: inline-block;
    }
    input, select {
      margin: 5px 0;
      padding: 8px;
      width: 250px;
      max-width: 100%;
      border: 1px solid #ccd2da;
      border-radius: 5px;
      font-size: 14px;
    }
    input::placeholder, textarea::placeholder {
      color: #aaa;
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background-color: #fff;
    }
    th {
      background-color: #2d5a88;
      color: white;
      font-weight: bold;
      padding: 12px 8px;
      text-align: center;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      vertical-align: middle;
      font-size: 14px;
      max-width: 150px;
      min-width: 100px;
      text-align: left;
      position: relative;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    td[contenteditable]:empty::before {
      content: attr(data-placeholder);
      color: #aaa;
      pointer-events: none;
      display: block;
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      white-space: nowrap;
      font-style: italic;
      user-select: none;
      overflow: hidden;
      max-width: calc(100% - 24px);
    }
    td[contenteditable] {
      position: relative;
      z-index: 1;
    }
    td.amount, td.total {
      background-color: #f0f0f0;
      user-select: none;
    }
    .totals p {
      margin: 10px 0;
      font-weight: bold;
    }
    .btn-section {
      margin-top: 25px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .btn-section button {
      background: #1b3a57;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .btn-section button:hover {
      background-color: #163050;
    }
    .signature-box {
      margin-top: 40px;
      display: flex;
      justify-content: flex-end;
      padding: 0 20px;
    }
    .signature-box img {
      height: 80px;
      margin-bottom: 5px;
    }
    .signature-box div {
      width: 200px;
      text-align: center;
      user-select: none;
      font-style: italic;
    }
    .add-btn {
      margin-top: 10px;
      background: #2d5a88;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .add-btn:hover {
      background-color: #1c3a57;
    }
    .delete-btn {
      background: #c0392b;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
      transition: background-color 0.3s;
    }
    .delete-btn:hover {
      background-color: #a83227;
    }
    @media print {
      header, nav, .btn-section, .add-btn, .delete-btn {
        display: none !important;
      }
      .box, table {
        page-break-inside: avoid;
      }
    }
    
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Everest Digital Stationery Logo" />
    Everest Digital Stationery - GST Invoice
  </header>
  
  <div class="container">
    <!-- Invoice Details -->
    <div class="box flex-row">
      <label>Invoice No:</label> <input type="text" placeholder="INV12345" />
      <label>Date:</label> <input type="datetime-local" />
      <label>Place of Supply:</label> <input type="text" value="Tamil Nadu" placeholder="State" />
      <label>GSTIN:</label> <input type="text" placeholder="29ABCDE1234F2Z5" />
      <label>PAN No:</label> <input type="text" placeholder="ABCDE1234F" />
      <label>Customer Email:</label> <input type="email" placeholder="example@gmail.com" />
    </div>

    <!-- Customer Details -->
    <div class="box flex-row">
      <label>Customer Name:</label> <input type="text" placeholder="Full Name" />
      <label>Address:</label> <input type="text" placeholder="Street, City" />
      <label>State:</label> <input type="text" value="Tamil Nadu" placeholder="State" />
      <label>GSTIN (Buyer):</label> <input type="text" placeholder="29ABCDE1234F2Z5" />
      <label>Mobile:</label> <input type="text" placeholder="9876543210" />
    </div>

    <!-- Items Table -->
    <div class="box">
      <table id="itemsTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>HSN</th>
            <th>Qty</th>
            <th>Rate</th>
            <th>Amount</th>
            <th>CGST %</th>
            <th>SGST %</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable data-placeholder="Enter Product Name"></td>
            <td contenteditable data-placeholder="Enter HSN"></td>
            <td contenteditable data-placeholder="Enter Quantity"></td>
            <td contenteditable data-placeholder="Enter Rate"></td>
            <td class="amount" contenteditable="false"></td>
            <td contenteditable data-placeholder="Enter CGST %"></td>
            <td contenteditable data-placeholder="Enter SGST %"></td>
            <td class="total" contenteditable="false"></td>
            <td><button class="delete-btn" onclick="this.parentElement.parentElement.remove(); calculateTotals();" aria-label="Delete row">‚ùå</button></td>
          </tr>
        </tbody>
      </table>
      <button class="add-btn" onclick="addItemRow()">+ Add Item</button>
    </div>

    <!-- Totals -->
    <div class="box totals">
      <p>Sub Total: ‚Çπ <input id="subTotal" type="text" value="0.00" readonly></p>
      <p>CGST Total: ‚Çπ <input id="cgstTotal" type="text" value="0.00" readonly></p>
      <p>SGST Total: ‚Çπ <input id="sgstTotal" type="text" value="0.00" readonly></p>
      <p><strong>Grand Total: ‚Çπ <input id="grandTotal" type="text" value="0.00" readonly></strong></p>
    </div>

    <!-- Buttons -->
    <div class="btn-section">
      <button onclick="window.location.reload()">Clear</button>
      <button onclick="downloadInvoicePDF()">Save Bill</button>
      <button onclick="window.print()">Print Invoice</button>
      <button onclick="sendEmail()">üìß Send Email</button>
      <button onclick="saveInvoiceToLocal()">Save Locally</button>


    </div>

    <!-- Signature Section -->
    <div class="signature-box">
      <div>
        <img src="Screenshot 2025-05-28 001517.png" alt="Authorized Signature" />
        <div>Authorized Signature</div>
      </div>
    </div>

    <script>
        
      function attachListeners(row) {
        ['qty','rate','cgst','sgst'].forEach(key => {
          const selectorMap = { qty:2, rate:3, cgst:5, sgst:6 };
          row.cells[selectorMap[key]].addEventListener('input', () => {
            calculateRow(row);
            calculateTotals();
          });
        });
      }

      function parseNumber(value) {
        const num = parseFloat(value);
        return isNaN(num) ? 0 : num;
      }

      function calculateRow(row) {
        const qty = parseNumber(row.cells[2].innerText);
        const rate = parseNumber(row.cells[3].innerText);
        const cgst = parseNumber(row.cells[5].innerText);
        const sgst = parseNumber(row.cells[6].innerText);
        const amount = qty * rate;
        const cgstAmt = amount * (cgst/100);
        const sgstAmt = amount * (sgst/100);
        const total = amount + cgstAmt + sgstAmt;
        row.cells[4].innerText = amount.toFixed(2);
        row.cells[7].innerText = total.toFixed(2);
      }

      function calculateTotals() {
        let sub=0, cg=0, sg=0, gr=0;
        document.querySelectorAll('#itemsTable tbody tr').forEach(r => {
          const a = parseNumber(r.cells[4].innerText);
          const c = parseNumber(r.cells[5].innerText);
          const s = parseNumber(r.cells[6].innerText);
          const ca = a*(c/100), sa = a*(s/100), t = a+ca+sa;
          sub += a; cg += ca; sg += sa; gr += t;
        });
        document.getElementById('subTotal').value = sub.toFixed(2);
        document.getElementById('cgstTotal').value = cg.toFixed(2);
        document.getElementById('sgstTotal').value = sg.toFixed(2);
        document.getElementById('grandTotal').value = gr.toFixed(2);
      }

      function addItemRow() {
        const tb = document.getElementById('itemsTable').querySelector('tbody');
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td contenteditable data-placeholder="Enter Product Name"></td>
          <td contenteditable data-placeholder="Enter HSN"></td>
          <td contenteditable data-placeholder="Enter Quantity"></td>
          <td contenteditable data-placeholder="Enter Rate"></td>
          <td class="amount" contenteditable="false"></td>
          <td contenteditable data-placeholder="Enter CGST %"></td>
          <td contenteditable data-placeholder="Enter SGST %"></td>
          <td class="total" contenteditable="false"></td>
          <td><button class="delete-btn" onclick="this.closest('tr').remove(); calculateTotals()">‚ùå</button></td>`;
        tb.appendChild(tr);
        attachListeners(tr);
      }

      window.onload = () => {
        document.querySelectorAll('#itemsTable tbody tr').forEach(attachListeners);
      };

      function downloadInvoicePDF() {
        const element = document.querySelector('.container');
        const options = {
          margin:       [0.5, 0.5, 0.5, 0.5],
          filename:     'Everest_Digital_Invoice.pdf',
          image:        { type: 'jpeg', quality: 0.98 },
          html2canvas:  { scale: 2, logging: false, scrollY: 0 },
          jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(options).from(element).save();
      }
      function sendEmail() {
    const customerEmail = document.querySelector("input[placeholder='example@gmail.com']").value || "";
    const customerName = document.querySelector("input[placeholder='Full Name']").value || "Valued Customer";
    const invoiceNo = document.querySelector("input[placeholder='INV12345']").value || "Invoice";
    const grandTotal = document.getElementById("grandTotal").value || "0.00";

    const subject = encodeURIComponent(`üìÑ Your Invoice (${invoiceNo}) from Everest Digital Stationery`);

    const body = encodeURIComponent(
`Hello ${customerName}! üòä

We hope this message finds you well. Thank you for shopping with Everest Digital Stationery ‚Äî your trusted partner for quality supplies! ‚ú®

Please find below your invoice details:

üßæ Invoice Number: ${invoiceNo}  
üíµ Total Amount: ‚Çπ${grandTotal}  

Your support means the world to us! üåç We take pride in delivering the best products and service to customers like you. If you have any questions or need assistance, feel free to reach out anytime. üìû‚úâÔ∏è

üí° Quick Tips:  
- Keep this invoice for your records.  
- Reach out if you want a copy in another format.  
- We‚Äôd love to hear your feedback to serve you better!  

Thank you once again for choosing Everest Digital Stationery. We look forward to serving you again soon! üõí‚ú®

Wishing you a wonderful day filled with success and happiness! üåüüòä

Warm regards,  
Team Everest Digital Stationery  
üìç Your Stationery Partner for Excellence` );

    const gmailURL = `https://mail.google.com/mail/?view=cm&fs=1&to=${customerEmail}&su=${subject}&body=${body}`;
    window.open(gmailURL, '_blank');
  }
  function saveInvoiceToLocal() {
  const invoiceData = {
    invoiceNo: document.querySelector('[placeholder="INV12345"]').value,
    date: document.querySelector('input[type="datetime-local"]').value,
    customerName: document.querySelector('[placeholder="Full Name"]').value,
    items: [],
  };

  const rows = document.querySelectorAll('#itemsTable tbody tr');
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    invoiceData.items.push({
      item: cells[0].innerText,
      hsn: cells[1].innerText,
      qty: cells[2].innerText,
      rate: cells[3].innerText,
      amount: cells[4].innerText,
      cgst: cells[5].innerText,
      sgst: cells[6].innerText,
      total: cells[7].innerText,
    });
  });

  localStorage.setItem('invoiceData', JSON.stringify(invoiceData));
  alert("Invoice saved in browser storage.");
}

    </script>
  </div>
</body>
</html>
